<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: jb | haya14busa]]></title>
  <link href="http://haya14busa.com/categories/jb/atom.xml" rel="self"/>
  <link href="http://haya14busa.com/"/>
  <updated>2015-12-31T21:37:09+09:00</updated>
  <id>http://haya14busa.com/</id>
  <author>
    <name><![CDATA[haya14busa]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[JBiOSでも自前ビルド/コンパイルがしたい！]]></title>
    <link href="http://haya14busa.com/build-or-compile-on-jb-ios/"/>
    <updated>2013-08-07T00:00:00+09:00</updated>
    <id>http://haya14busa.com/build-or-compile-on-jb-ios</id>
    <content type="html"><![CDATA[<h2>Attention</h2>

<p>お決まりですが自己責任でお願いします.割とコアの部分触るので特に.そもそも脱獄自体グレーゾーンだし.</p>

<h2>JBiOSだとターミナルでプログラミングできたりするけど…</h2>

<p>Appleの署名かなんかの関係でgccが一発で通らないので今まで、自前でビルド/コンパイルができてませんでした.</p>

<p>iOS4あたりまでは簡単に?回避できてたらしいけど、iOS5からはできなくなってて諦めるしかなかった.</p>

<p>この記事通りにやると,vimとかgitとかをcydiaのリポジトリにかかわらず最新版使えるようになったりする(はず).</p>

<h2>Setup gcc on iOS 5 and maybe iOS6</h2>

<ol>
<li>リポジトリをcydiaに追加

<ul>
<li><a href="http://cydia.radare.org">http://cydia.radare.org</a></li>
</ul>
</li>
<li>追加したリポジトリから<strong>libgcc</strong>をインストール

<ul>
<li>fakegccとかiosgccとかでググってリポジトリ以外から持ってくる手もある</li>
</ul>
</li>
<li>デフォのBigbossなどから基本のコマンドなどなどをインストール

<ul>
<li>Link Identity Editor (ldid)

<ul>
<li>署名回避に必要</li>
</ul>
</li>
<li>GNU C Compiler(gcc)

<ul>
<li>Cコンパイラ</li>
</ul>
</li>
<li>Make</li>
<li>APT 0.7系</li>
<li>足りなければBigBoss Recommentded Toolsとか基本系を</li>
</ul>
</li>
<li>MobileTerminalかOpenSSHをインストール

<ul>
<li>OpenSSHでiSSHとかAppstoreのアプリから操作もできるし、勿論母艦からでもOK</li>
</ul>
</li>
</ol>


<p>ここまでの状態だと</p>

<p>on iOS</p>

<pre><code>$ echo 'void main() { printf("Hello, world!\n"); }' &gt; helloworld.c
$ gcc helloworld.c -o helloworld
$ ./helloworld
# ここで署名エラー
$ ldid -S helloworld
$ ./helloworld
Hello, world!
</code></pre>

<p>このように一度<code>ldid -S</code>を噛ませる必要があるせいで、<code>./configure</code>とかが通らなくなってます.</p>

<p>なので<code>ldid -S</code>を自動化して擬似的に署名を回避する必要があります.</p>

<h2>Bypassing Apple Code signature using ldid -S</h2>

<pre><code>$ git clone git@github.com:haya14busa/ios-build
$ sudo mv /usr/bin/gcc /usr/bin/realgcc
$ sudo mv /usr/bin/arch /usr/bin/realarch
$ cd ios-build
$ chmod +x gcc arch
$ sudo cp gcc /usr/bin/
$ sudo cp arch /usr/bin/
$ sudo ln -s /usr/bin/gcc /usr/bin/cc
$ sudo ldid -S /usr/bin/gcc
$ sudo ldid -S /usr/bin/arch
</code></pre>

<p>(コマンド自体がkillされた場合は<code>sudo ldid -S {killされたコマンドのpath}</code>で回避できる)</p>

<p>archは確かgitを自前ビルドしたときにエラー吐いただけなので今のところはgccの記述だけでもOK.またgit cloneしなくても普通に持ってきてvimで書くとか、iFileで直接置いてもいい.</p>

<p>gccの中身</p>

<pre><code>#!/bin/bash

output='a.out'
next=false
for arg in "$@" ; do
    if [ "$next" == "true" ]; then
        output=$arg
        break
    elif [ "$arg" == "-o" ]; then
        next="true"
    fi
done

realgcc $*

if [ -f "$output" ]; then
    ldid -S "$output"
    echo "Signed with ldid"
fi
</code></pre>

<p>シェルスクリプトで、realgccでコンパイルしてできた実行ファイルに自動でldid -Sするようにしてます.</p>

<p>これで<code>./configure</code>が通ってmakeもできるのでiOSで自前でビルドできるようになります.</p>

<h2>成果</h2>

<h3>Git</h3>

<ul>
<li>2013/08/07現在最新バージョンである1.8.3.4をコンパイル->正常動作</li>
<li>Cydiaリポのgitは1.5とかのレベルで,radareにある1.7.8.2はうまく動かないのでこれだけでもやったかいがあった</li>
</ul>


<h3>Vim</h3>

<ul>
<li>999までpatchを当てた7.3.999をコンパイル可能.あとから1000以上のpatchがあることに気づいてやり直したけど、うまく当てれなかった.</li>
<li>Cydiaリポのvimよりは新しいバージョンを使うことに成功</li>
<li>しかし、やりたかった+pythonオプションがどうしてもつかなかった</li>
<li><blockquote><p>PYTHON DISABLED &lt;</p></blockquote></li>
</ul>


<h3>Mercurial</h3>

<ul>
<li>vimの最新バージョンを楽に取ってくるためにインストールを試みるも失敗</li>
<li>radareリポジトリにmercurialがあるがインストール出来ない模様</li>
</ul>


<h3>Python</h3>

<ul>
<li>radareリポジトリのpythonは2.7.3なので,自前で2.7.5のコンパイルを試みるも失敗</li>
<li>gccオプションが付いていないからかnumpyなどがインストール出来ないので出来れば自前でコンパイルしたかった</li>
<li>cのヘッダ関係で失敗してるっぽい</li>
</ul>


<h2>結論</h2>

<p><strong>JBiPadでプログラミングなんかしてないで,ノーパソが欲しい.</strong></p>

<h2>Link</h2>

<ul>
<li><a href="https://github.com/haya14busa/ios-build">haya14busa/ios-build</a></li>
<li><a href="http://ininjas.com/forum/index.php?topic=1626.msg46557">Need to disable codesign</a></li>
<li><a href="https://rc-z.me/blog/archives/2012/02/29/setup-gcc-on-iphone-4s-running-ios-5/" class="broken_link">Setup gcc On iPhone 4S running iOS 5 &#8211; RC.Z</a></li>
<li><a href="http://n8.io/how-to-set-up-gcc-on-ios-4/">How To: Set up GCC on iOS 4 — n8.io</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
