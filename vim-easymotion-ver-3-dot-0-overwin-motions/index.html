
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="ja"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Vimのカーソル移動はもっともっと爆速になる! Vim-EasyMotion v3.0 をリリースしました - haya14busa</title>
  <meta name="author" content="haya14busa">

  
  <meta name="description" content="Vim-EasyMotion でウィンドウをまたいだ移動ができるようになりました!!! easymotion/vim-easymotion 過去の関連記事 Vim-Easymotionを拡張してカーソルを縦横無尽に楽々移動する - haya14busa まだ fork でやってた時代の記事． &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="haya14busa" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39461503-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <div id="container">
    <header role="banner"><hgroup>
  <h1><a href="/">haya14busa</a></h1>
  
    <h2>haya14busa&#8217;s memo</h2>
  
</hgroup>

</header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="site:haya14busa.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
    <div id="main">
      <div id="content">
        <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title"><a href="">Vimのカーソル移動はもっともっと爆速になる! Vim-EasyMotion v3.0 をリリースしました</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-01-19T03:14:43+09:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


<div class="entry-content"><p>Vim-EasyMotion でウィンドウをまたいだ移動ができるようになりました!!!</p>

<p><img src="https://raw.githubusercontent.com/haya14busa/i/2753bd4dd1dfdf5962dbdbffabf24244e4e14243/easymotion/overwin-motions.gif" alt="" /></p>

<div class="github-card" data-github="easymotion/vim-easymotion" data-width="500" data-height="150" data-theme="default"></div>


<p><a href="https://github.com/easymotion/vim-easymotion">easymotion/vim-easymotion</a></p>

<h3>過去の関連記事</h3>

<ul>
<li><a href="http://haya14busa.com/vim-lazymotion-on-speed/">Vim-Easymotionを拡張してカーソルを縦横無尽に楽々移動する - haya14busa</a>

<ul>
<li>まだ fork でやってた時代の記事． 自分のVim歴より始まりが古く，1年続いたという伝説のVim Advent Calendar 2012の363日目の記事で懐かしい．</li>
</ul>
</li>
<li><a href="http://haya14busa.com/mastering-vim-easymotion/">Vim-EasyMotionでカーソル移動を爆速にして生産性をもっと向上させる - haya14busa</a>

<ul>
<li>easymotionのメンテナになってからの便利機能まとめ的な記事.</li>
</ul>
</li>
</ul>


<p>そして今回の記事はvim-easymotionのリポジトリがorganization持ちになって<del>久々に</del>便利機能追加したという記事になります．</p>

<p>vim-easymotionとはVimのカーソル移動をブラウザでいうHit-A-Hint機能のように行うカーソル移動改善系プラグインです．
よく知らないよ〜という方は<a href="https://github.com/easymotion/vim-easymotion">README</a>眺めたり， 過去記事 (<a href="http://haya14busa.com/mastering-vim-easymotion/">Vim-EasyMotionでカーソル移動を爆速にして生産性をもっと向上させる - haya14busa</a> ) をさらっと読むと分かるかと思います．過去記事は<code>n-key Find Motion</code>の節以外はだいたい現役で使えると思います．</p>

<h2>vim-easymotion v3.0</h2>

<p><img src="https://raw.githubusercontent.com/haya14busa/i/2753bd4dd1dfdf5962dbdbffabf24244e4e14243/easymotion/overwin-motions.gif" alt="" /></p>

<p><a href="https://github.com/easymotion/vim-easymotion/releases/tag/v3.0.0">Release EasyMotion now supports moving cursor over/across windows · easymotion/vim-easymotion</a></p>

<p>vim-easymotionではこれまでカーソルと同一ウィンドウ内にしか移動できなかったのですが，v3.0でとうとう他のウィンドウにも移動できるようになりました! めでたい．
実はv3.0 で追加するメイン機能はこれだけなんですが，個人的にかなり気に入ってしまい，「これはメジャーバージョンアップするしかない」と思い勢いだけでバージョンあげています．
他にはバグフィックスとか細かい修正で，とくに後方互換性は壊してないはずなので気軽にアップデートできると思います．</p>

<h3>追加したマッピング</h3>

<table>
<thead>
<tr>
<th> mapping </th>
<th> description </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;Plug&gt;(easymotion-overwin-f){char}</code> </td>
<td> <code>{char}</code> にマッチする位置を対象として移動 </td>
</tr>
<tr>
<td><code>&lt;Plug&gt;(easymotion-overwin-f2){char}{char}</code> </td>
<td> <code>{char}{char}</code> にマッチする位置を対象として移動 </td>
</tr>
<tr>
<td><code>&lt;Plug&gt;(easymotion-overwin-line)</code> </td>
<td> 行を対象として移動 </td>
</tr>
<tr>
<td><code>&lt;Plug&gt;(easymotion-overwin-w)</code> </td>
<td> 単語の先頭を対象として移動 </td>
</tr>
</tbody>
</table>


<h4>マッピング例</h4>

<p>ヴィジュアルモードやオペレータ待機モードで他のウィンドウに移動するというのは意味をなさないので，
他のウィンドウに移動する overwin モーションは <code>Normal</code> モードのマッピングのみ提供しています．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="c">&quot; &lt;Leader&gt;f{char} to move to {char}</span>
</span><span class='line'>map  <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">f</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span><span class="k">bd</span><span class="p">-</span><span class="k">f</span><span class="p">)</span>
</span><span class='line'>nmap <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">f</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span>overwin<span class="p">-</span><span class="k">f</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">&quot; s{char}{char} to move to {char}{char}</span>
</span><span class='line'>nmap <span class="k">s</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span>overwin<span class="p">-</span>f2<span class="p">)</span>
</span><span class='line'>vmap <span class="k">s</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span><span class="k">bd</span><span class="p">-</span>f2<span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">&quot; Move to line</span>
</span><span class='line'>map <span class="p">&lt;</span>Leader<span class="p">&gt;</span>L <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span><span class="k">bd</span><span class="p">-</span>jk<span class="p">)</span>
</span><span class='line'>nmap <span class="p">&lt;</span>Leader<span class="p">&gt;</span>L <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span>overwin<span class="p">-</span>line<span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">&quot; Move to word</span>
</span><span class='line'>map  <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">w</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span><span class="k">bd</span><span class="p">-</span><span class="k">w</span><span class="p">)</span>
</span><span class='line'>nmap <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">w</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>easymotion<span class="p">-</span>overwin<span class="p">-</span><span class="k">w</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>EasyMotion触ったことなくてミニマムに始めたい場合は上記設定から気に入ったもの +
以下の設定でデフォルトマッピングをオフにするとよいかなと思います．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">let</span> <span class="k">g</span>:EasyMotion_do_mapping <span class="p">=</span> <span class="m">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>もしひとつだけおすすめするなら<code>nmap s &lt;Plug&gt;(easymotion-overwin-f2)</code>がオススメです．
このマッピングだと画面上の見えているところへならどこへでも <code>s{char}{char}{hint}</code>の4 キーストロークで移動できます．
<code>&lt;Plug&gt;(easymotion-overwin-f)</code>や<code>&lt;Plug&gt;(easymotion-overwin-w)</code>だと候補が多すぎてヒントを2回以上打たないとダメなケースがよくあるのですが，
<code>{char}{char}</code>と2文字打つと候補が劇的に減ってヒントは大抵のケースで1文字入力するだけですみます．</p>

<h4>incsearch.vim との連携</h4>

<p>vim-easymotionには<code>&lt;Plug&gt;(easymotion-sn)</code>という <code>N</code> 文字入力してマッチした位置
を対象として移動するモーション，言わばeasymotionの検索(<code>/</code>)版マッピングを提供していたのですが，
今回，それのウィンドウ間移動できるマッピングは提供していません．</p>

<p>というのも，<code>&lt;Plug&gt;(easymotion-sn)</code>はVimデフォルトの検索との互換性が甘いところがあり，
<a href="http://haya14busa.com/incsearch-dot-vim-ver-2/">Vimの検索はもっともっと便利になる! incsearch.vim v2.0 をリリースしました - haya14busa</a>
の記事で紹介した incsearch.vim と vim-easymotion を連携させたほうが基本的に便利になっていて，
こちらを推奨したいなという訳です．</p>

<h4>必要なもの</h4>

<ul>
<li><a href="https://github.com/easymotion/vim-easymotion">easymotion/vim-easymotion</a></li>
<li><a href="https://github.com/haya14busa/incsearch.vim">haya14busa/incsearch.vim</a></li>
<li><a href="https://github.com/haya14busa/incsearch-easymotion.vim">haya14busa/incsearch-easymotion.vim</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="c">&quot; You can use other keymappings like &lt;C-l&gt; instead of &lt;CR&gt; if you want to</span>
</span><span class='line'><span class="c">&quot; use these mappings as default search and somtimes want to move cursor with</span>
</span><span class='line'><span class="c">&quot; EasyMotion.</span>
</span><span class='line'><span class="k">function</span><span class="p">!</span> <span class="k">s</span>:incsearch_config<span class="p">(</span>...<span class="p">)</span> abort
</span><span class='line'>  <span class="k">return</span> <span class="nb">incsearch</span>#util#deepextend<span class="p">(</span>deepcopy<span class="p">(</span>{
</span><span class='line'>  \   <span class="s1">&#39;modules&#39;</span>: [<span class="nb">incsearch</span>#config#easymotion#module<span class="p">(</span>{<span class="s1">&#39;overwin&#39;</span>: <span class="m">1</span>}<span class="p">)</span>]<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;keymap&#39;</span>: {
</span><span class='line'>  \     <span class="s2">&quot;\&lt;CR&gt;&quot;</span>: <span class="s1">&#39;&lt;Over&gt;(easymotion)&#39;</span>
</span><span class='line'>  \   }<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;is_expr&#39;</span>: <span class="m">0</span>
</span><span class='line'>  \ }<span class="p">),</span> <span class="k">get</span><span class="p">(</span><span class="k">a</span>:<span class="p">,</span> <span class="m">1</span><span class="p">,</span> {}<span class="p">))</span>
</span><span class='line'><span class="k">endfunction</span>
</span><span class='line'>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> /  <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>incsearch_config<span class="p">())</span>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> ?  <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>incsearch_config<span class="p">(</span>{<span class="s1">&#39;command&#39;</span>: <span class="s1">&#39;?&#39;</span>}<span class="p">))</span>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> <span class="k">g</span>/ <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>incsearch_config<span class="p">(</span>{<span class="s1">&#39;is_stay&#39;</span>: <span class="m">1</span>}<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>&lt;CR&gt;</code> を <code>&lt;C-l&gt;</code>とかにすることで普段は普通の incsearch.vim, <code>&lt;C-l&gt;</code>押した時に
easymotion発動といったことができたりします．僕はそういう設定にしていて，便利につかえてます．</p>

<h2>おまけ</h2>

<h3>incsearch-migemo 連携</h3>

<p><a href="https://github.com/haya14busa/incsearch-migemo.vim">haya14busa/incsearch-migemo.vim</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">function</span><span class="p">!</span> <span class="k">s</span>:config_migemo<span class="p">(</span>...<span class="p">)</span> abort
</span><span class='line'>  <span class="k">return</span> extend<span class="p">(</span>copy<span class="p">(</span>{
</span><span class='line'>  \   <span class="s1">&#39;converters&#39;</span>: [
</span><span class='line'>  \     <span class="nb">incsearch</span>#config#migemo#converter<span class="p">(),</span>
</span><span class='line'>  \   ]<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;modules&#39;</span>: [<span class="nb">incsearch</span>#config#easymotion#module<span class="p">(</span>{<span class="s1">&#39;overwin&#39;</span>: <span class="m">1</span>}<span class="p">)</span>]<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;keymap&#39;</span>: {<span class="s2">&quot;\&lt;C-l&gt;&quot;</span>: <span class="s1">&#39;&lt;Over&gt;(easymotion)&#39;</span>}<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;is_expr&#39;</span>: <span class="m">0</span><span class="p">,</span>
</span><span class='line'>  \ }<span class="p">),</span> <span class="k">get</span><span class="p">(</span><span class="k">a</span>:<span class="p">,</span> <span class="m">1</span><span class="p">,</span> {}<span class="p">))</span>
</span><span class='line'><span class="k">endfunction</span>
</span><span class='line'>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> <span class="k">m</span>/ <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>config_migemo<span class="p">())</span>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> <span class="k">m</span>? <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>config_migemo<span class="p">(</span>{<span class="s1">&#39;command&#39;</span>: <span class="s1">&#39;?&#39;</span>}<span class="p">))</span>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> mg/ <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>config_migemo<span class="p">(</span>{<span class="s1">&#39;is_stay&#39;</span>: <span class="m">1</span>}<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>fuzzy search で easymotion</h3>

<p><img src="https://raw.githubusercontent.com/haya14busa/i/eab1d12a8bd322223d551956a4fd8a21d5c4bfe9/easymotion/fuzzy-incsearch-easymotion.gif" alt="" /></p>

<ul>
<li><a href="https://github.com/haya14busa/incsearch.vim">haya14busa/incsearch.vim</a></li>
<li><a href="https://github.com/haya14busa/incsearch-fuzzy.vim">haya14busa/incsearch-fuzzy.vim</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">function</span><span class="p">!</span> <span class="k">s</span>:config_easyfuzzymotion<span class="p">(</span>...<span class="p">)</span> abort
</span><span class='line'>  <span class="k">return</span> extend<span class="p">(</span>copy<span class="p">(</span>{
</span><span class='line'>  \   <span class="s1">&#39;converters&#39;</span>: [<span class="nb">incsearch</span>#config#fuzzyword#converter<span class="p">()</span>]<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;modules&#39;</span>: [<span class="nb">incsearch</span>#config#easymotion#module<span class="p">(</span>{<span class="s1">&#39;overwin&#39;</span>: <span class="m">1</span>}<span class="p">)</span>]<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;keymap&#39;</span>: {<span class="s2">&quot;\&lt;CR&gt;&quot;</span>: <span class="s1">&#39;&lt;Over&gt;(easymotion)&#39;</span>}<span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;is_expr&#39;</span>: <span class="m">0</span><span class="p">,</span>
</span><span class='line'>  \   <span class="s1">&#39;is_stay&#39;</span>: <span class="m">1</span>
</span><span class='line'>  \ }<span class="p">),</span> <span class="k">get</span><span class="p">(</span><span class="k">a</span>:<span class="p">,</span> <span class="m">1</span><span class="p">,</span> {}<span class="p">))</span>
</span><span class='line'><span class="k">endfunction</span>
</span><span class='line'>
</span><span class='line'><span class="nb">noremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;&lt;</span>expr<span class="p">&gt;</span> <span class="p">&lt;</span>Space<span class="p">&gt;</span>/ <span class="nb">incsearch</span>#<span class="k">go</span><span class="p">(&lt;</span>SID<span class="p">&gt;</span>config_easyfuzzymotion<span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<h2>実装とか背景の話</h2>

<p>実はこのウィンドウをまたいだ移動についてはvim-easymotionの開発を引き継いだころからずっと欲しいなぁ〜やりたいな〜と思っていた待望の機能でした．
emacs版easymotionである <a href="https://github.com/winterTTr/ace-jump-mode">winterTTr/ace-jump-mode</a> や atomのsmalls (<a href="http://qiita.com/t9md/items/bca96d45af1a5244b5d1">ATOM - smalls つくった - Qiita</a>)ではラベルジャンプでウィンドウ移動ができています．</p>

<p>どの拡張も，もともとはEasyMotion にインスパイアされて作ったもので，他の機能はともかく少なくともウィンドウ間をまたげるという一点ではvim-easymotionを上回っていました．
ではなぜ，vim-easymotionでもやりたいなぁと思っていたのに，これまで実装できていなかったかというと，
これは<strong>「vim-easymotionのコードがちょっと闇でつらかった&hellip;」</strong>というわけではなく Vim の機能でやるのがきつかったことに起因します．
Vimにはオーバーレイで文字を表示するといった機能がないのでvim-easymotionでは一旦バッファの文字を書き換えて戻すという実装になっていました．
この実装だと同じバッファを別ウィンドウに表示している場合にラベルがバッティングしてしまいます．</p>

<p>では今回どうしたかというと Vim の conceal 機能, <a href="http://vim-jp.org/vimdoc-ja/syntax.html#%3Asyn-cchar">:h syn-cchar</a> を使っています．
この機能を使えば直接バッファを書き換えずにラベルを表示できるので，同じバッファが別ウィンドウにあっても違ったラベルを表示することが可能です．</p>

<h3>Conceal の syn-cchar つらい問題</h3>

<p>しかし，このconcealでラベルを表示するというアイデア自体は以前からあって <a href="https://github.com/justinmk/vim-sneak">justinmk/vim-sneak</a>
がこのスタイルで表示しています(カーソルと同一ウィンドウだけですが)．
前からアイデアを知っていたのにやれなかったのは，決して<strong>「vim-easymotionのコードがちょっと闇でつらかった&hellip;」</strong>というわけではなく
conceal機能はかなり制限があってやりたいことができなさそうだなぁと長らく思っていたからです．
というも，syn-ccharでは1文字しか表示できないし，空白行といった無の部分に文字を表示することができません．
この制限からラベルが2文字以上の時でも1文字しか表示できなかったり，
Tab文字や文字幅が2以上のマルチバイトの文字をラベルに置き換えるとラベル表示時に表示にズレが生じてしまいます．</p>

<h3>結局<strong>「vim-easymotionのコードがちょっと闇でつらかった&hellip;」</strong></h3>

<p>じゃあどうすればいいかというと，ここまでの話・実装を組み合わせると実は答えは出ています．
ラベルを表示するさいに対象が空白行や行末，マルチバイト文字であれば一旦スペースを追加またはスペースに置き換えてしまう前処理をすればOKです．
そうすれば空白行や行末を対象とできるし，2文字のラベルも表示できるし，ラベルを表示した際に表示のズレが生じません!
やったぜこれで理論上実装可能じゃん!</p>

<p>なぜこれに気づくのに時間がかかったのかというと結局<strong>「vim-easymotionのコードがちょっと闇でつらかった&hellip;」</strong>
のでしばらくeasymotionにまともに向き合ってなかったからでした．
vim-easymotionはforkする前のもともとコードがそんなに綺麗じゃなかった上に，
プログラミング自体ほとんど初心者だった僕が以前に便利な機能を追加したりVimとの互換性を保ったりすることと引き換えに，
コードは比較的カオス状態になっていました．
僕の実装力ではこれを互換性を保った状態でリファクタして他のウィンドウへ移動する抜本的な機能改善なんて無理や&hellip;
と内心思っていましたし，実際無理感あります．
こういった理由でウィンドウ間移動という待望の機能は2年間ほど待望の機能であり続けました．</p>

<h3>1から作って互換性意識すればいいんじゃん?</h3>

<p>互換性保ちながらリファクタしていくのがつらいなら1から作って，インターフェースを既存のeasymotionと合わせればいいんじゃないか?
と気付き，今回の機能は実装されました．</p>

<p>「パンがなければお菓子を食べればいいじゃない」に通ずるものがあります(ない)</p>

<p>これに気づいてやってみると，一旦動くところまで実装する程度なら1日程度で待望の機能が実装できました．
やってみるものですね．</p>

<p>しかし，vim-easymotionを活発に開発していた2年前の僕にはできなかったかなぁと感じていて，
これまでに incsearch.vim といった他のプラグインを作った知見や，他の Vim プラグイン開発者から得た知見，
そして2年間でちょっと基本的な開発力があがったおかげで開発できたなぁと思います．
みなさまありがとうございました．そして自分，まだまだですがちょっと頑張ったなって思いました．</p>

<p>開発の実装や背景の話と2年前に熱を入れて取り組んでいたvim-easymotionに今の自分が取り組んでみたらちょっと感慨深かったなという話でした．</p>

<h2>おわりに</h2>

<p><a href="https://github.com/easymotion/vim-easymotion">vim-easymotion</a>, また一段と便利になったので是非使ってみてください!</p>

<p>僕はもうこの機能なしでは生きていけなさそうです．</p>

<p><strong>あぁ〜カーソルがぴょんぴょんするんじゃぁ〜</strong></p>

<blockquote class="twitter-tweet" lang="en"><p lang="ja" dir="ltr">vim-easymotion, あぁ〜カーソルがぴょんぴょんするんじゃぁ〜 って感じだ</p>&mdash; はやぶさ (@haya14busa) <a href="https://twitter.com/haya14busa/status/687679866175500288">January 14, 2016</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<script src="http://lab.lepture.com/github-cards/widget.js"></script>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">haya14busa</span></span>

      








  



<time datetime="2016-01-19T03:14:43+09:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/categories/vim/'>vim</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://b.hatena.ne.jp/entry/http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/" data-via="haya14busa" data-counturl="http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/hatena-intern-2015/" title="Previous Post: 2015年夏，はてなインターンでMackerelをとにかく便利にして優勝してきた">&laquo; 2015年夏，はてなインターンでMackerelをとにかく便利にして優勝してきた</a>
      
      
        <a class="basic-alignment right" href="/revital-vim-makes-vital-vim-a-log-faster/" title="Next Post: revital.vim で vital.vim を爆速にしてお前らの Vim plugin を速くする">revital.vim で vital.vim を爆速にしてお前らの Vim plugin を速くする &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

      </div><!-- /div#content -->
    </div><!-- /div#main -->
  </div><!-- /div.container -->
  <footer><div id="footer-widgets-wrapper">
  <div id="footer-first" class="footer-widget">
    <h3>About Me</h3>
    <section class="about-me">
      
        <img class="icon-image" src="https://0.gravatar.com/avatar/dca89778aa3e6bc49f0e100df1a1a1f0?s=240" alt="icon_image">
      
      <div>
        <ul>
          
            <li>GitHub: <a href="https://github.com/haya14busa">@haya14busa</a></li>
          
          
            <li>Twitter: <a href="https://twitter.com/haya14busa">@haya14busa</a></li>
          
            <li>Blog: <a href="http://haya14busa.com">http://haya14busa.com</a></li>
        </ul>
        <p>
          V!mm!shment Th!s World!
        </p>
      </div>
    </section>
  </div><!-- /div#footer-second -->

  <div id="footer-second" class="footer-widget">
    <h3>Recent Posts</h3>
    <section id="hatena-popular" class="hatena-bookmark">
      <script language="javascript" type="text/javascript" src="http://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
      <script language="javascript" type="text/javascript">
        Hatena.BookmarkWidget.url   = "http://haya14busa.com";
        Hatena.BookmarkWidget.title = "Recent Posts";
        Hatena.BookmarkWidget.sort  = "hot";
        Hatena.BookmarkWidget.width = 0;
        Hatena.BookmarkWidget.num   = 10;
        Hatena.BookmarkWidget.theme = "notheme";
        Hatena.BookmarkWidget.load();
      </script>
    </section>
  </div><!-- /div#footer-second -->

  <div id="footer-third" class="footer-widget">
    <h3>Popular Posts</h3>
    <section id="hatena-popular" class="hatena-bookmark">
      <script language="javascript" type="text/javascript" src="http://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
      <script language="javascript" type="text/javascript">
        Hatena.BookmarkWidget.url   = "http://haya14busa.com";
        Hatena.BookmarkWidget.title = "Popular Posts";
        Hatena.BookmarkWidget.sort  = "count";
        Hatena.BookmarkWidget.width = 0;
        Hatena.BookmarkWidget.num   = 10;
        Hatena.BookmarkWidget.theme = "notheme";
        Hatena.BookmarkWidget.load();
      </script>
    </section>
  </div><!-- /div#footer-third -->
</div><!-- /div#footer-widgets-wrapper -->

<div id="credit" role="contentinfo">
  <p>
    Copyright &copy; 2016 - <a href="https://github.com/haya14busa/">haya14busa</a> -
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/haya14busa/mjolvim-octotheme">Mjolvim</a></span>
  </p>
</div>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'haya14busa-s-memo';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/';
        var disqus_url = 'http://haya14busa.com/vim-easymotion-ver-3-dot-0-overwin-motions/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
